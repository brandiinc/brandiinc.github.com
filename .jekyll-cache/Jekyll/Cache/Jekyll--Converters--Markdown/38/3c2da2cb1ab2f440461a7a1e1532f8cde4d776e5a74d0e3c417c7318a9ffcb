I"Rœ<p><strong>ëª©ì°¨</strong><br />
<a href="#link1">1.</a> INTRO<br />
<a href="#link2">2.</a> CHAPTER 1<br />
<span class="indent"><a href="#link3">1.</a> The Recommendation Problem</span>
<span class="indent"><a href="#link4">2.</a> ëª…ì‹œì  ì ìˆ˜(Explicit Rating)</span>
<span class="indent"><a href="#link5">3.</a> ì•”ë¬µì  í”¼ë“œë°±(Implicit Feedback)</span>
<span class="indent"><a href="#link6">4.</a> ë¸Œëœë”” ì„œë¹„ìŠ¤ ì† ëª…ì‹œì  ì ìˆ˜ì™€ ì•”ë¬µì  í”¼ë“œë°±</span>
<a href="#link7">3.</a> CHAPTER 2<br />
<span class="indent"><a href="#link8">1.</a> ì˜ˆì œ ì‹¤ìŠµ</span>
<a href="#link9">4.</a> CONCLUSION<br /></p>

<hr />

<p><a name="link1"></a></p>
<h2 id="intro">INTRO</h2>

<p>ì§€ë‚œ 10ì›”, ë¸Œëœë”” ë©ìŠ¤ì— â€˜ê°œë°œ 1íŒ€ì˜ AWS Personalize ë„ì „ê¸°â€™ ë¥¼ ê²Œì¬í•˜ë©´ì„œ í•˜ë‚˜ì˜ ë¯¸ì…˜ì„ ë°›ì•˜ìŠµë‹ˆë‹¤. ë°”ë¡œ AWS SageMaker(ì´í•˜ SageMaker)ë¥¼ ì´ìš©í•´ ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ì„ ë‹¤ë¤„ë³´ëŠ” ê²ƒì´ì—ˆëŠ”ë°ìš”. ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ëª¨ë¥´ë©´ AWS RDSë¥¼ ì‚¬ìš©í•˜ê¸° ì–´ë µë“¯ì´, ë¨¸ì‹ ëŸ¬ë‹ì— ëŒ€í•´ ëª¨ë¥´ëŠ” ìƒíƒœì—ì„œëŠ” SageMakerë¥¼ ë‹¤ë£¨ê¸°ê°€ ë§¤ìš° ì–´ë ¤ì› ìŠµë‹ˆë‹¤.</p>

<p>ì´ë²ˆ ì‹œê°„ì—ëŠ” AWS Machine Learning Blogì— ì˜¬ë¼ì™€ ìˆëŠ” <a href="https://aws.amazon.com/ko/blogs/machine-learning/extending-amazon-sagemaker-factorization-machines-algorithm-to-predict-top-x-recommendations/">í¬ìŠ¤íŠ¸ ì˜ˆì œ</a>ë¥¼ í†µí•´ SageMakerë¡œ ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ì„ í›ˆë ¨, ë°°í¬ë¥¼ í•œ ê²½í—˜ì„ ê³µìœ í•˜ê³ ì í•©ë‹ˆë‹¤. CHAPTER 1 ì—ì„œëŠ” ë¨¸ì‹ ëŸ¬ë‹ì˜ ê¸°ë³¸ì ì¸ ê°œë…ì„ ê°„ë‹¨íˆ ì •ë¦¬í•˜ê³ , CHAPTER 2 ì—ëŠ” ì˜ˆì œ ì‹¤ìŠµì„ í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ë¨¸ì‹ ëŸ¬ë‹ì— ëŒ€í•´ ê¸°ë³¸ ì§€ì‹ì´ ìˆìœ¼ì‹  ë…ìë¶„ì€ CHAPTER 2 ë¡œ ë°”ë¡œ ë„˜ì–´ê°€ì‹œë©´ ë©ë‹ˆë‹¤.</p>

<p><em>(ì°¸ê³ . CHAPTER2 ì—ì„œëŠ” ì˜ˆì œì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ìœ¼ë¡œ ì§„í–‰ë˜ë©° ì½”ë“œ ì „ì²´ì— ëŒ€í•œ ì„¤ëª…ì€ ì§„í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)</em></p>

<hr />

<p><a name="link2"></a></p>
<h2 id="chapter-1">CHAPTER 1.</h2>

<p><a name="link3"></a></p>
<h3 id="the-recommendation-problem">The Recommendation Problem</h3>

<p>ì¶”ì²œì‹œìŠ¤í…œì€ ì‚¬ìš©ìê°€ í•­ëª©ì— ëŒ€í•´ í‰ê°€í•œ ê³¼ê±° ì„ í˜¸ë„<em>(ex. ë¦¬ë·°, ì°œ)</em>ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì•„ì§ ì‚¬ìš©í•˜ì§€ ì•Šì€ í•­ëª©ì— ëŒ€í•´ ì‚¬ìš©ìì˜ í‰ê°€ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤. ì‚¬ìš©ì u ê°€ í•­ëª© i ë¥¼ ì–¼ë§ˆë‚˜ ì¢‹ì•„í•  ê²ƒì¸ì§€ ë‚˜íƒ€ë‚´ëŠ” ê°’ì„ ë“±ê¸‰ Rui ë¼ê³  í–ˆì„ ë•Œ ë“±ê¸‰ ê°’ì€ í‰ì  ë°ì´í„°ì²˜ëŸ¼ 1ì—ì„œ 5ì‚¬ì´ì˜ ì‹¤ìˆ˜í˜• ë“±ê¸‰ ê°’ì¼ ìˆ˜ë„ ìˆê³ , í´ë¦­ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì´ì§„ ë“±ê¸‰ ê°’ì¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì´ ë•Œ í‰ì  ë°ì´í„°ëŠ” ëª…ì‹œì  ì ìˆ˜(Explicit Rating), í´ë¦­ ì—¬ë¶€ ë°ì´í„°ëŠ” ì•”ë¬µì  í”¼ë“œë°±(Implicit Feedback)ì´ë¼ê³  í•©ë‹ˆë‹¤.</p>

<p>ì„±ëŠ¥ì´ ì¢‹ì€ ì¶”ì²œì‹œìŠ¤í…œì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” í•´ê²°í•˜ê³ ì í•˜ëŠ” ë¬¸ì œë¥¼ ì œëŒ€ë¡œ ì´í•´í•´ì•¼ í•˜ê³ , ëª…ì‹œì  ì ìˆ˜ ë° ì•”ë¬µì  í”¼ë“œë°±ì— ëŒ€í•œ ì„ íƒì„ í•´ì•¼ í•©ë‹ˆë‹¤.
<br /><br /></p>

<p><a name="link4"></a></p>
<h3 id="ëª…ì‹œì -ì ìˆ˜explicit-rating">ëª…ì‹œì  ì ìˆ˜(Explicit Rating)</h3>

<p>í›„ê¸° í‰ì ê³¼ ê°™ì´ ì´ë¯¸ ë§Œë“¤ì–´ì§„ ì ìˆ˜ ë²”ìœ„ ì•ˆì—ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ì ìœ¼ë¡œ ì ìˆ˜ì²™ë„ì— ê´€ì—¬í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì¶”ì²œ ì‹œìŠ¤í…œì— ëŒ€í•œ ì´ˆê¸° ì—°êµ¬ë“¤ì´ ëª…ì‹œì  ì ìˆ˜ì— ê¸°ë°˜í•˜ì—¬ ë§ì´ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ëª…ì‹œì  ì ìˆ˜ëŠ” ê°ê´€ì ìœ¼ë¡œ ì²™ë„ë¥¼ íŒë‹¨í•˜ê¸° ì–´ë ¤ìš´ ë³€ìˆ˜ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.</p>

<p>ì˜ˆë¥¼ ë“¤ì–´ ë§ˆìŒì— ë“œëŠ” ì˜·ì„ êµ¬ë§¤í–ˆë‹¤ê³  íŒë‹¨í–ˆì„ ë•Œ ëŒ€ë¶€ë¶„ì˜ ì‚¬ìš©ìëŠ” ë³„4ê°œ ë˜ëŠ” 5ê°œì˜ í›„í•œ ì ìˆ˜ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê·¸ì € ê·¸ëŸ° ì˜·ì´ë¼ê³  íŒë‹¨ë˜ì—ˆì„ ê²½ìš° ë³„1ê°œë„ ì•„ê¹Œì›Œì„œ ì•„ì˜ˆ ì ìˆ˜ë¥¼ ë§¤ê¸°ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì¦‰, ìƒí’ˆì— ëŒ€í•œ êµ¬ë§¤ ë°ì´í„° ëŒ€ë¹„ í‰ê°€ ë°ì´í„°ëŠ” ë§¤ìš° í¬ë°•í•©ë‹ˆë‹¤. ì´ê²ƒì„ ë¨¸ì‹ ëŸ¬ë‹ì—ì„œ <strong><em>í¬ì†Œ ë°ì´í„°</em></strong>  ë˜ëŠ” <strong><em>í¬ì†Œí•˜ë‹¤(Sparse)</em></strong> ë¼ê³  í‘œí˜„í•©ë‹ˆë‹¤.
<br /><br /></p>

<p><a name="link5"></a></p>
<h3 id="ì•”ë¬µì -í”¼ë“œë°±implicit-feedback">ì•”ë¬µì  í”¼ë“œë°±(Implicit Feedback)</h3>

<p>êµ¬ë§¤ì—¬ë¶€/ì¡°íšŒì—¬ë¶€ì²˜ëŸ¼ ëª…ì‹œì ìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ ì—†ëŠ” ë°ì´í„°ë“¤ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ëª…ì‹œì  ì ìˆ˜ì— ë¹„í•´ ì„ í˜¸ë„ë¥¼ ì œëŒ€ë¡œ í‘œí˜„í•  ìˆ˜ ì—†ë‹¤ëŠ” ë‹¨ì ì´ ìˆì§€ë§Œ, ì´ëŠ” ì•”ë¬µì  ì ìˆ˜ë¥¼ ì–´ë–»ê²Œ í•´ì„í•˜ëŠëƒì— ë”°ë¼ ì–´ëŠ ì •ë„ ê·¹ë³µì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>

<p>ì˜ˆë¥¼ ë“¤ì–´ íŠ¹ì • ìƒí’ˆì„ ì°œ í–ˆìœ¼ë©´ 1, ì•„ë‹ˆë©´ 0 ìœ¼ë¡œ êµ¬ë¶„í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì¶”ì²œí–ˆìœ¼ë‚˜ ì°œ í•˜ì§€ ì•Šì•˜ë‹¤ë©´ -1, ì¶”ì²œë˜ì§€ ì•Šì•˜ë‹¤ë©´ 0, ì°œì„ í–ˆë‹¤ë©´ 1 ê·¸ë¦¬ê³  êµ¬ë§¤ê¹Œì§€ í–ˆë‹¤ë©´ 2ì ì„ ë¶€ì—¬í•˜ëŠ” ì‹ìœ¼ë¡œ ë ˆì´íŒ…ì„ ë‹¬ë¦¬í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì•”ë¬µì  í”¼ë“œë°±ì€ ëª…ì‹œì  ì ìˆ˜ ëŒ€ë¹„ ë°ì´í„° ìˆ˜ì§‘ì´ ì‰¬ìš°ë©° ì´ë¥¼ <strong><em>ë°€ì§‘ ë°ì´í„°</em></strong>  ë˜ëŠ” <strong><em>ë°€ì§‘í•˜ë‹¤(Dense)</em></strong> ë¼ê³  í‘œí˜„í•©ë‹ˆë‹¤.
<br /><br /></p>

<p><a name="link6"></a></p>
<h3 id="ë¸Œëœë””-ì„œë¹„ìŠ¤-ì†-ëª…ì‹œì -ì ìˆ˜ì™€-ì•”ë¬µì -í”¼ë“œë°±-">ë¸Œëœë”” ì„œë¹„ìŠ¤ ì† ëª…ì‹œì  ì ìˆ˜ì™€ ì•”ë¬µì  í”¼ë“œë°± ğŸ§</h3>

<figure class="fitcontent">
  <img src="http://labs.brandi.co.kr///assets/2020/20200128/01.png" alt="sagemaker" />
</figure>
<figcaption>[ê·¸ë¦¼ 1] ëª…ì‹œì  ì ìˆ˜ (ìƒí’ˆì— ëŒ€í•œ Rating í‰ê°€)</figcaption>
<p><br /></p>

<figure class="fitcontent">
  <img src="http://labs.brandi.co.kr///assets/2020/20200128/02.png" alt="sagemaker" />
</figure>
<figcaption>[ê·¸ë¦¼ 2] ì•”ë¬µì  í”¼ë“œë°± (ì°œí•œ ìƒí’ˆ, ìµœê·¼ ë³¸ ìƒí’ˆ)</figcaption>

<p><br /><br /></p>

<p><a name="link7"></a><a name="link8"></a></p>
<h2 id="chapter-2">CHAPTER 2.</h2>

<p>ì´ë²ˆ ì‹œê°„ì— ë‹¤ë£° ì˜ˆì œëŠ” Movielens ì˜ ì˜í™” í‰ì  ë°ì´í„° ì„¸íŠ¸ë¥¼ ì´ìš©í•˜ì—¬ FM ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ íŠ¸ë ˆì´ë‹ í›„ KNN ì•Œê³ ë¦¬ì¦˜ì— ë§ê²Œ ë³€í™˜í•˜ì—¬ ìƒìœ„ Nê°œì˜ ì˜í™”ë¥¼ ì¶”ì²œí•´ì£¼ëŠ” ë‚´ìš©ì…ë‹ˆë‹¤. ì•ì„œ ë§í–ˆë“¯ í‰ì  ë°ì´í„°ëŠ” ëª…ì‹œì  ì ìˆ˜ì´ê¸° ë•Œë¬¸ì— Matrix Factorization ì•Œê³ ë¦¬ì¦˜ë³´ë‹¤ Sparse Dataì— ì í•©í•œ FM ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
<br /></p>

<p>ê·¸ëŸ¼ ì‹¤ì „ìœ¼ë¡œ ë°”ë¡œ ë“¤ì–´ê°€ë³¼ê¹Œìš”? ğŸƒâ€â™€ï¸
<br /><br /></p>

<p>2-1. ë¨¼ì € í•„ìš”í•œ ëª¨ë“ˆë“¤ì„ import í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sagemaker</span>
<span class="kn">import</span> <span class="nn">sagemaker.amazon.common</span> <span class="k">as</span> <span class="n">smac</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">sagemaker</span> <span class="kn">import</span> <span class="n">get_execution_role</span>
<span class="kn">from</span> <span class="nn">sagemaker.predictor</span> <span class="kn">import</span> <span class="n">json_deserializer</span>
<span class="kn">from</span> <span class="nn">sagemaker.amazon.amazon_estimator</span> <span class="kn">import</span> <span class="n">get_image_uri</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">lil_matrix</span>
</code></pre></div></div>
<p><br />
2-2. Movielens ì˜ ì˜í™” í‰ì  ë°ì´í„° ì„¸íŠ¸ë¥¼ ë‹¤ìš´ë¡œë“œí•œ í›„ <strong><em>ë°ì´í„° ì…”í”Œ [1]</em></strong> ì„ ì§„í–‰í•©ë‹ˆë‹¤.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë°ì´í„° ì„¸íŠ¸ ë‹¤ìš´ë¡œë“œ</span>
<span class="o">!</span>wget http://files.grouplens.org/datasets/movielens/ml-100k.zip
<span class="o">!</span>unzip <span class="nt">-o</span> ml-100k.zip

<span class="c"># ë°ì´í„° ì…”í”Œ</span>
<span class="o">!</span><span class="nb">shuf </span>ml-100k/ua.base <span class="nt">-o</span> ml-100k/ua.base.shuffled
</code></pre></div></div>
<p><br /></p>

<hr />

<p><em>[1] íŠ¸ë ˆì´ë‹ ê²°ê³¼ê°€ â€˜ì‹¬í•œ ë¶ˆê· í˜•â€™ì„ ë³´ì´ì§€ ì•Šë„ë¡ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì˜í™”ì— ëŒ€í•´ ë¡œë§¨ìŠ¤ ì¹´í…Œê³ ë¦¬ â†’ ê³µí¬ ì¹´í…Œê³ ë¦¬ â†’ ì¶”ë¦¬ ì¹´í…Œê³ ë¦¬ ìˆœì„œë¡œ í•™ìŠµì„ ì‹œí‚¤ë©´, ë§¨ ì²˜ìŒ í•™ìŠµëœ ë¡œë§¨ìŠ¤ ì¹´í…Œê³ ë¦¬ì— ëŒ€í•´ì„œë§Œ ìµœì  ê°’ì„ ë°°ìš°ê²Œ ë˜ì–´ ê·¸ ë’¤ë¡œëŠ” íš¨ìœ¨ì´ ì—†ëŠ” í•™ìŠµì„ ì§„í–‰í•˜ê²Œ ë©ë‹ˆë‹¤. ë°”ë¡œ ì´ëŸ° í˜„ìƒì„ ë§‰ê¸° ìœ„í•´ ë°ì´í„°ë¥¼ ë¬´ì‘ìœ„ë¡œ ì„ëŠ” ê²ƒì…ë‹ˆë‹¤.</em></p>

<hr />
<p><br /></p>

<p>2-3. íŠ¸ë ˆì´ë‹ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># íŠ¸ë ˆì´ë‹ ë°ì´í„°ë¥¼ Pandas DataFrame ì— ë‹´ìŠµë‹ˆë‹¤.
</span><span class="n">user_movie_ratings_train</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span>
  <span class="s">'ua.base.shuffled'</span><span class="p">,</span>
  <span class="n">sep</span><span class="o">=</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span>
  <span class="n">index_col</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
  <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">'user_id'</span> <span class="p">,</span> <span class="s">'movie_id'</span> <span class="p">,</span> <span class="s">'rating'</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># ìƒìœ„ 5ê±´ ë°ì´í„°ë¥¼ ì¶œë ¥ì‹œí‚µë‹ˆë‹¤.
</span><span class="n">user_movie_ratings_train</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>
<p><br /></p>

<p>2-4. í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ Pandas DataFrame ì— ë‹´ìŠµë‹ˆë‹¤.
</span><span class="n">user_movie_ratings_test</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span>
  <span class="s">'ua.test'</span><span class="p">,</span>
  <span class="n">sep</span><span class="o">=</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span>
  <span class="n">index_col</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
  <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">'user_id'</span> <span class="p">,</span> <span class="s">'movie_id'</span> <span class="p">,</span> <span class="s">'rating'</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># ìƒìœ„ 5ê±´ ë°ì´í„°ë¥¼ ì¶œë ¥ì‹œí‚µë‹ˆë‹¤.
</span><span class="n">user_movie_ratings_test</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>
<p><br /></p>

<p>2-5. <strong><em>FM íŠ¸ë ˆì´ë‹ ëª¨ë¸ [2]</em></strong> ì„ ì¤€ë¹„í•©ë‹ˆë‹¤.</p>

<hr />

<p>[2] <em>í˜„ì¬ AWS SageMakerì—ì„œ FM Algorithm ì…ë ¥ì— ëŒ€í•´ì„œëŠ” Float32 í…ì„œê°€ í¬í•¨ëœ recordIO-protobuf í˜•ì‹ë§Œ ì§€ì›í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì™ ì§€ ì–´ë ¤ì›Œë³´ì´ì§€ë§Œ Amazon SageMaker SDK ì—ì„œ ë³€í™˜ê¸°ëŠ¥ì„ ì œê³µí•´ì£¼ê¸° ë•Œë¬¸ì— ì „í˜€ ê±±ì •í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.</em></p>

<p><em>ìš°ë¦¬ëŠ” FM ëª¨ë¸ë¡œ One-hot encodedëœ í¬ì†Œí–‰ë ¬(Sparse Matrix)ì„ ë§Œë“¤ ê²ƒì´ë©°, 4ì  ì´ìƒì˜ ë°ì´í„°ë§Œ ê³ ë ¤í•  ê²ƒì…ë‹ˆë‹¤.</em><br />
<em>ê²°ê³¼ì ìœ¼ë¡œëŠ” 4ì  ì´ìƒë§Œ 1ì´ê³  ë‚˜ë¨¸ì§€ëŠ” 0ì¸ í¬ì†Œí–‰ë ¬ì´ ë§Œë“¤ì–´ ì§‘ë‹ˆë‹¤.</em></p>

<hr />

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">loadDataset</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="c1"># (lines, columns) ëª¨ì–‘ì˜ ë¹ˆ í¬ì†Œ í–‰ë ¬ì„ ë§Œë“¤ê³  float32 íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">lil_matrix</span><span class="p">((</span><span class="n">lines</span><span class="p">,</span> <span class="n">columns</span><span class="p">)).</span><span class="n">astype</span><span class="p">(</span><span class="s">'float32'</span><span class="p">)</span>
    <span class="c1"># ë ˆì´ë¸”ì˜ ì—¬ê¸°ì— ì €ì¥ë©ë‹ˆë‹¤.
</span>    <span class="n">Y</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">line</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">X</span><span class="p">[</span><span class="n">line</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">'user_id'</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">X</span><span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="n">nb_users</span><span class="o">+</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'product_id'</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># 4ì  ì´ìƒì˜ ë°ì´í„°ë§Œ ê³ ë ¤í•©ë‹ˆë‹¤.
</span>        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'rating'</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">Y</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Y</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">+</span><span class="mi">1</span>

    <span class="n">Y</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">Y</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="s">'float32'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span><span class="n">Y</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nb_users</span> <span class="o">=</span> <span class="n">train_set</span><span class="p">[</span><span class="s">'user_id'</span><span class="p">].</span><span class="nb">max</span><span class="p">()</span>
<span class="n">nb_products</span> <span class="o">=</span> <span class="n">train_set</span><span class="p">[</span><span class="s">'product_id'</span><span class="p">].</span><span class="nb">max</span><span class="p">()</span>
<span class="n">nb_features</span> <span class="o">=</span> <span class="n">nb_users</span> <span class="o">+</span> <span class="n">nb_products</span>

<span class="n">nb_ratings_test</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_product_ratings_test</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">nb_ratings_train</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_product_ratings_train</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>

<span class="k">print</span> <span class="p">(</span><span class="s">'# of users: '</span><span class="p">,</span> <span class="n">nb_users</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'# of products: '</span><span class="p">,</span> <span class="n">nb_products</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Features (# of users + # of movies): '</span><span class="p">,</span> <span class="n">nb_features</span><span class="p">)</span>

<span class="k">print</span> <span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">LoadDataset...'</span><span class="p">)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span> <span class="o">=</span> <span class="n">loadDataset</span><span class="p">(</span><span class="n">user_product_ratings_train</span><span class="p">,</span> <span class="n">nb_ratings_train</span><span class="p">,</span> <span class="n">nb_features</span><span class="p">)</span>
<span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">loadDataset</span><span class="p">(</span><span class="n">user_product_ratings_test</span><span class="p">,</span> <span class="n">nb_ratings_test</span><span class="p">,</span> <span class="n">nb_features</span><span class="p">)</span>

<span class="k">print</span> <span class="p">(</span><span class="s">'Success'</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">assert</span> <span class="n">X_train</span><span class="p">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">nb_ratings_train</span><span class="p">,</span> <span class="n">nb_features</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">Y_train</span><span class="p">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">nb_ratings_train</span><span class="p">,</span> <span class="p">)</span>

<span class="n">zero_labels</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">Y_train</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Training labels: %d zeros, %d ones"</span> <span class="o">%</span> <span class="p">(</span><span class="n">zero_labels</span><span class="p">,</span> <span class="n">nb_ratings_train</span><span class="o">-</span><span class="n">zero_labels</span><span class="p">))</span>

<span class="k">assert</span> <span class="n">X_test</span><span class="p">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">nb_ratings_test</span><span class="p">,</span> <span class="n">nb_features</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">Y_test</span><span class="p">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">nb_ratings_test</span><span class="p">,</span> <span class="p">)</span>

<span class="n">zero_labels</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">Y_test</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Test labels: %d zeros, %d ones"</span> <span class="o">%</span> <span class="p">(</span><span class="n">zero_labels</span><span class="p">,</span> <span class="n">nb_ratings_test</span><span class="o">-</span><span class="n">zero_labels</span><span class="p">))</span>
</code></pre></div></div>
<p><br /></p>

<p>ìœ„ ì½”ë“œë¥¼ ì°¨ë¡€ë¡œ ì‹¤í–‰í•œ í›„ì˜ ê²°ê³¼ë¥¼ ë³´ì‹œë©´ zero_labelsê°€ ì›”ë“±íˆ ë§ì€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Training labels: 3461 zeros, 538 ones
Test labels: 869 zeros, 133 ones
</code></pre></div></div>
<p><br /></p>

<p>2-6. <strong><em>Protobuf íƒ€ì… [3]</em></strong> ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ S3ë¡œ ì—…ë¡œë“œí•©ë‹ˆë‹¤.</p>

<hr />

<p>[3] ì•ì„œ ë§í–ˆë“¯, SageMakerì— ë‚´ì¥ëœ FM ì•Œê³ ë¦¬ì¦˜ì€ protobuf í˜•ì‹ì˜ ë°ì´í„°ë§Œ ì…ë ¥ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” SageMaker SDKì—ì„œ ì œê³µí•˜ëŠ” ë©”ì†Œë“œë¥¼ ê°€ì§€ê³  protobufë¡œ ë³€í™˜, S3ë¡œ ì—…ë¡œë“œí•  ê²ƒì…ë‹ˆë‹¤.</p>

<hr />

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">writeDatasetToProtobuf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">d_type</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">BytesIO</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">d_type</span> <span class="o">==</span> <span class="s">'sparse'</span><span class="p">:</span>
        <span class="n">smac</span><span class="p">.</span><span class="n">write_spmatrix_to_sparse_tensor</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">smac</span><span class="p">.</span><span class="n">write_numpy_to_dense_tensor</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>

    <span class="n">buf</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="s">'{}/{}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="n">boto3</span><span class="p">.</span><span class="n">resource</span><span class="p">(</span><span class="s">'s3'</span><span class="p">).</span><span class="n">Bucket</span><span class="p">(</span><span class="n">bucket</span><span class="p">).</span><span class="n">Object</span><span class="p">(</span><span class="n">obj</span><span class="p">).</span><span class="n">upload_fileobj</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

    <span class="k">return</span> <span class="s">'s3://{}/{}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span><span class="n">obj</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì—…ë¡œë“œ í•  ê²½ë¡œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">'labs-fm'</span>

<span class="n">train_key</span> <span class="o">=</span> <span class="s">'train.protobuf'</span>
<span class="n">train_prefix</span> <span class="o">=</span> <span class="s">'{}/{}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s">'train'</span><span class="p">)</span>

<span class="n">test_key</span> <span class="o">=</span> <span class="s">'test.protobuf'</span>
<span class="n">test_prefix</span> <span class="o">=</span> <span class="s">'{}/{}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s">'test'</span><span class="p">)</span>

<span class="n">output_prefix</span> <span class="o">=</span> <span class="s">'s3://{}/{}/output'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fm_train_data_path</span> <span class="o">=</span> <span class="n">writeDatasetToProtobuf</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">train_prefix</span><span class="p">,</span> <span class="n">train_key</span><span class="p">,</span> <span class="s">'sparse'</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">fm_test_data_path</span>  <span class="o">=</span> <span class="n">writeDatasetToProtobuf</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">test_prefix</span><span class="p">,</span> <span class="n">test_key</span><span class="p">,</span> <span class="s">'sparse'</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>

<span class="k">print</span> <span class="p">(</span><span class="s">'Training data S3 path: '</span><span class="p">,</span><span class="n">fm_train_data_path</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Test data S3 path: '</span><span class="p">,</span><span class="n">fm_test_data_path</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'FM model output S3 path: {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">output_prefix</span><span class="p">))</span>
</code></pre></div></div>
<p><br /></p>

<p>ìœ„ ì½”ë“œë¥¼ ì°¨ë¡€ë¡œ ì‹¤í–‰í•œ í›„ ì¶œë ¥ëœ S3ê²½ë¡œì— ì ‘ê·¼í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ protobuf íŒŒì¼ì´ ìƒì„±ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<figure class="fitcontent">
  <img src="http://labs.brandi.co.kr///assets/2020/20200128/03.png" alt="sagemaker" />
</figure>
<figcaption></figcaption>

<p><br /></p>

<p>2-7. ì¤€ë¹„ëœ ëª¨ë¸ì„ íŠ¸ë ˆì´ë‹í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># íŠ¸ë ˆì´ë‹ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…ì€ ì •í•´ì ¸ ìˆìœ¼ë©°, ê·¸ ì™¸ íƒ€ì…ì„ ì§€ì •í•  ê²½ìš° ValidationException ê°€ ë°œìƒí•©ë‹ˆë‹¤.
# ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…ì´ ë„ˆë¬´ ì‘ì„ ê²½ìš°ì—ëŠ” OutOfMemoryError ê°€ ë°œìƒí•˜ë¯€ë¡œ ì¤€ë¹„ëœ ëª¨ë¸ì˜ í¬ê¸°ë¥¼ ê³ ë ¤í•˜ì—¬ ì§€ì •í•©ë‹ˆë‹¤.
</span><span class="n">instance_type</span><span class="o">=</span><span class="s">'ml.m5.large'</span>

<span class="n">fm</span> <span class="o">=</span> <span class="n">sagemaker</span><span class="p">.</span><span class="n">estimator</span><span class="p">.</span><span class="n">Estimator</span><span class="p">(</span>
  <span class="n">get_image_uri</span><span class="p">(</span><span class="n">boto3</span><span class="p">.</span><span class="n">Session</span><span class="p">().</span><span class="n">region_name</span><span class="p">,</span> <span class="s">'factorization-machines'</span><span class="p">),</span>
  <span class="n">get_execution_role</span><span class="p">(),</span>
  <span class="n">train_instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
  <span class="n">train_instance_type</span><span class="o">=</span><span class="n">instance_type</span><span class="p">,</span>
  <span class="n">output_path</span><span class="o">=</span><span class="n">output_prefix</span><span class="p">,</span>
  <span class="n">sagemaker_session</span><span class="o">=</span><span class="n">sagemaker</span><span class="p">.</span><span class="n">Session</span><span class="p">(),</span>
<span class="p">)</span>

<span class="c1"># í•„ìˆ˜ë¡œ ì ìš©í•´ì£¼ì–´ì•¼ í•˜ëŠ” í•˜ì´í¼íŒŒë¼ë¯¸í„°ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
</span><span class="n">fm</span><span class="p">.</span><span class="n">set_hyperparameters</span><span class="p">(</span>
  <span class="n">feature_dim</span><span class="o">=</span><span class="n">nb_features</span><span class="p">,</span>
  <span class="n">predictor_type</span><span class="o">=</span><span class="s">'binary_classifier'</span><span class="p">,</span>
  <span class="n">num_factors</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># í›ˆë ¨ì„ ì‹œì‘í•©ë‹ˆë‹¤!
</span><span class="n">fm</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="s">'train'</span><span class="p">:</span> <span class="n">fm_train_data_path</span><span class="p">,</span>
    <span class="s">'test'</span><span class="p">:</span> <span class="n">fm_test_data_path</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>
<p><br /></p>

<p>2-8. ì´ì œ KNN ì•Œê³ ë¦¬ì¦˜ì— ë§ì¶° ëª¨ë¸ì„ ë¦¬íŒ¨í‚¤ì§•í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ëª¨ë“ˆì´ ì—†ì„ ê²½ìš°ì—ëŠ” pip install ê³¼ì •ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
</span><span class="kn">import</span> <span class="nn">mxnet</span> <span class="k">as</span> <span class="n">mx</span>

<span class="n">model_file_name</span> <span class="o">=</span> <span class="s">'model.tar.gz'</span>
<span class="n">model_full_path</span> <span class="o">=</span> <span class="n">fm</span><span class="p">.</span><span class="n">output_path</span> <span class="o">+</span><span class="s">'/'</span><span class="o">+</span> <span class="n">fm</span><span class="p">.</span><span class="n">latest_training_job</span><span class="p">.</span><span class="n">job_name</span> <span class="o">+</span><span class="s">'/output/'</span><span class="o">+</span><span class="n">model_file_name</span>

<span class="k">print</span> <span class="s">'Model Path: '</span><span class="p">,</span> <span class="n">model_full_path</span>

<span class="c1"># S3 ë²„í‚·ìœ¼ë¡œë¶€í„° FM ëª¨ë¸ì„ ë‹¤ìš´ë¡œë“œ í•©ë‹ˆë‹¤.
</span><span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">'aws s3 cp '</span><span class="o">+</span><span class="n">model_full_path</span><span class="o">+</span> <span class="s">' .'</span><span class="p">)</span>

<span class="c1"># ëª¨ë¸ì„ ì¶”ì¶œí•˜ì—¬ MXNet ìœ¼ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
</span><span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">'tar xzvf '</span><span class="o">+</span><span class="n">model_file_name</span><span class="p">)</span>
<span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">'unzip -o model_algo-1'</span><span class="p">)</span>
<span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">'mv symbol.json model-symbol.json'</span><span class="p">)</span>
<span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">'mv params model-0000.params'</span><span class="p">)</span>


<span class="n">m</span> <span class="o">=</span> <span class="n">mx</span><span class="p">.</span><span class="n">module</span><span class="p">.</span><span class="n">Module</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">'./model'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">label_names</span><span class="o">=</span><span class="p">[</span><span class="s">'out_label'</span><span class="p">])</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">_arg_params</span><span class="p">[</span><span class="s">'v'</span><span class="p">].</span><span class="n">asnumpy</span><span class="p">()</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">_arg_params</span><span class="p">[</span><span class="s">'w1_weight'</span><span class="p">].</span><span class="n">asnumpy</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">_arg_params</span><span class="p">[</span><span class="s">'w0_weight'</span><span class="p">].</span><span class="n">asnumpy</span><span class="p">()</span>

<span class="c1"># ì•„ì´í…œ ì ì¬ ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
</span><span class="n">knn_item_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">V</span><span class="p">[</span><span class="n">nb_users</span><span class="p">:],</span> <span class="n">w</span><span class="p">[</span><span class="n">nb_users</span><span class="p">:]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">knn_train_label</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nb_movies</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># ì‚¬ìš©ì ì ì¬ ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
</span><span class="n">ones</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nb_users</span><span class="p">).</span><span class="n">reshape</span><span class="p">((</span><span class="n">nb_users</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">knn_user_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">V</span><span class="p">[:</span><span class="n">nb_users</span><span class="p">],</span> <span class="n">ones</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>
<p><br /><br /></p>

<p>2-9. KNN ëª¨ë¸ì„ ì¤€ë¹„,ë°°í¬í•œ í›„ ë°°ì¹˜ ë³€í™˜ì„ í†µí•´ ì¶”ë¡  ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>

<figure class="fitcontent">
  <img src="http://labs.brandi.co.kr///assets/2020/20200128/04.png" alt="sagemaker" />
</figure>
<figcaption></figcaption>

<p><br /></p>

<p><a name="link9"></a></p>
<h2 id="conclusion">CONCLUSION</h2>

<p>SageMakerëŠ” ë‚´ì¥í˜• Jupyter Notebook ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì œê³µí•´ì£¼ê¸° ë•Œë¬¸ì— ì„œë²„ ê´€ë¦¬ë¥¼ í•  í•„ìš”ì—†ì´ ì‰½ê²Œ ë°ì´í„°ë¥¼ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¿ë§Œ ì•„ë‹ˆë¼ AWS SDKë¥¼ í†µí•´ ëª¨ë¸ì„ ì‰½ê²Œ ë³€í™˜, í•™ìŠµ, ë°°í¬í•  ìˆ˜ ìˆìœ¼ë©° ì˜ˆì œì—ì„œëŠ” ë‹¤ë£¨ì§€ ì•Šì•˜ì§€ë§Œ ì˜ˆì¸¡ ê²°ê³¼ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ì—¬ ìºì‹±í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>

<p>ê°œì¸ì ìœ¼ë¡œ ë³¸ ê¸€ì„ ì¤€ë¹„í•˜ë©´ì„œ ë¨¸ì‹ ëŸ¬ë‹ì— ëŒ€í•œ ê¸°ë³¸ì ì¸ ì§€ì‹ê³¼ ì•Œê³ ë¦¬ì¦˜ì— ëŒ€í•œ ì´í•´ë¥¼ ì¶©ë¶„íˆ í•˜ì§€ ëª»í•œ ì•„ì‰¬ì›€ì´ ìˆìŠµë‹ˆë‹¤. Movielensì˜ ì˜ˆì œ ìƒ˜í”Œ ë°ì´í„°ê°€ ì•„ë‹Œ ë¸Œëœë””ì˜ ìƒí’ˆ ë¦¬ë·° ë°ì´í„°ë¥¼ ë‹¤ë¤„ë³´ê³  ì‹¶ì—ˆì§€ë§Œ, íŠ¸ë ˆì´ë‹ ëª¨ë¸ì´ MXnet ëª¨ë“ˆì—ì„œ ì½í˜€ì§€ì§€ ì•Šê±°ë‚˜ ì›-í•« ì¸ì½”ë”© ê³¼ì •ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ë¶€ë¶„ì„ í•´ê²°í•˜ì§€ ëª»í•˜ì˜€ìŠµë‹ˆë‹¤. ëª¨ë¸ì„ í›ˆë ¨, ë°°í¬í•˜ëŠ” ê³¼ì • ë˜í•œ ì‹œê°„ê³¼ í° ë¹„ìš©ì´ ë°œìƒí•˜ê¸° ë•Œë¬¸ì— ì›ì¸ì„ ì°¾ì•„ê°€ëŠ” ê³¼ì •ì€ ì‰½ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>

<p>í•˜ì§€ë§Œ ì´ë²ˆ ì‹œê°„ì„ í†µí•´ ë¨¸ì‹ ëŸ¬ë‹ì— ì¡°ê¸ˆ ê°€ê¹Œì›Œì§„ ê²ƒ ê°™ì•„ ë¿Œë“¯í•©ë‹ˆë‹¤!<br />
ì €ëŠ” ì•ìœ¼ë¡œ ì‹œê°„ì„ ë“¤ì—¬ ê¸°ë³¸ê¸°ë¥¼ ì¢€ ë” ë‹¤ì§„ í›„ ì¬ë„ì „ í•´ë³´ê² ìŠµë‹ˆë‹¤. ğŸ¤› í™”ì´íŒ…!</p>

<hr />

<h3 id="ì°¸ê³ -2019ë…„-12ì›”-ê¸°ì¤€">ì°¸ê³  (2019ë…„ 12ì›” ê¸°ì¤€)</h3>

<ul>
  <li>í˜¸ìŠ¤íŒ… ì„œë¹„ìŠ¤ì—ì„œ ëª¨ë¸ì„ ë°°í¬í•  ë•Œ ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…ì„ â€˜ml.t2.mediumâ€™ ì´ ì•„ë‹Œ ë‹¤ë¥¸ íƒ€ì…ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²½ìš° ìì› ì´ˆê³¼ ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ë‹¤. â€˜ml.t2.mediumâ€™ ìœ¼ë¡œëŠ” ìì›ì´ ë¶€ì¡±í•˜ì—¬ ë°°í¬ë¥¼ ì§„í–‰í•  ìˆ˜ ì—†ì—ˆìœ¼ë©°, AWS Support ë¡œ ë¬¸ì˜í•´ì•¼ í•˜ëŠ” ê²ƒìœ¼ë¡œ í™•ì¸í•˜ì˜€ë‹¤.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ResourceLimitExceeded</span><span class="p">:</span> <span class="n">An</span> <span class="n">error</span> <span class="n">occurred</span> <span class="p">(</span><span class="n">ResourceLimitExceeded</span><span class="p">)</span> <span class="n">when</span> <span class="n">calling</span> <span class="n">the</span> <span class="n">CreateEndpoint</span> <span class="n">operation</span><span class="p">:</span> <span class="n">The</span> <span class="n">account</span><span class="o">-</span><span class="n">level</span> <span class="n">service</span> <span class="n">limit</span> <span class="s">'ml.m5.2xlarge for endpoint usage'</span> <span class="ow">is</span> <span class="mi">0</span> <span class="n">Instances</span><span class="p">,</span> <span class="k">with</span> <span class="n">current</span> <span class="n">utilization</span> <span class="n">of</span> <span class="mi">0</span> <span class="n">Instances</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">request</span> <span class="n">delta</span> <span class="n">of</span> <span class="mi">1</span> <span class="n">Instances</span><span class="p">.</span> <span class="n">Please</span> <span class="n">contact</span> <span class="n">AWS</span> <span class="n">support</span> <span class="n">to</span> <span class="n">request</span> <span class="n">an</span> <span class="n">increase</span> <span class="k">for</span> <span class="n">this</span> <span class="n">limit</span><span class="p">.</span>
</code></pre></div></div>

<ul>
  <li>
    <p>ì°¸ê³ ë¬¸í—Œ</p>

    <p>[1] <a href="https://aws.amazon.com/ko/blogs/machine-learning/extending-amazon-sagemaker-factorization-machines-algorithm-to-predict-top-x-recommendations/">https://aws.amazon.com/ko/blogs/machine-learning/extending-amazon-sagemaker-factorization-machines-algorithm-to-predict-top-x-recommendations/</a></p>

    <p>[2] <a href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/whatis.html">https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/whatis.html</a></p>

    <p>[3] <a href="https://zzaebok.github.io/machine_learning/factorization_machines/">https://zzaebok.github.io/machine_learning/factorization_machines/</a></p>
  </li>
</ul>
:ET