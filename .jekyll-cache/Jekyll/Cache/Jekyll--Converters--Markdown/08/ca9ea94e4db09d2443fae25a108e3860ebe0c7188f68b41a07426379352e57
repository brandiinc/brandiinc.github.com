I"¢w<h2 id="overview">Overview</h2>

<p>ì•ˆë“œë¡œì´ë“œ ì•± ê°œë°œì‹œ ë·°ëª¨ë¸ì„ êµ¬í˜„í•  ë•Œ, ì•¡í‹°ë¹„í‹° ë˜ëŠ” í”„ë˜ê·¸ë¨¼íŠ¸ì˜ êµ¬ì„± ë³€ê²½ì—ë„ ë°ì´í„°ê°€ ìœ ì§€ë˜ëŠ” <code class="language-plaintext highlighter-rouge">AAC-ViewModel</code> í´ë˜ìŠ¤ë¥¼ ìƒì†í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">AAC-ViewModel</code> ì„ ì‚¬ìš©í•œë‹¤ë©´ ë·°ëª¨ë¸ ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ ìƒëª…ì£¼ê¸°ì— ë§ì¶° ë°ì´í„°ë¥¼ ë³´ì¡´í•˜ê¸° ìœ„í•´ í”„ë¡œê·¸ë˜ë¨¸ëŠ” <code class="language-plaintext highlighter-rouge">ViewModelProvider.Factory</code> ë§Œ êµ¬í˜„í•˜ê³  <code class="language-plaintext highlighter-rouge">ViewModelProvider</code> í´ë˜ìŠ¤ê°€ ë·°ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê´€ë¦¬í•˜ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">viewModel</span><span class="p">:</span> <span class="nc">MainViewModel</span> <span class="k">by</span> <span class="nf">lazy</span> <span class="p">{</span>
        <span class="nc">ViewModelProvider</span><span class="p">(</span>
            <span class="k">this</span><span class="p">,</span>
            <span class="kd">object</span> <span class="err">: </span><span class="nc">ViewModelProvider</span><span class="p">.</span><span class="nc">Factory</span> <span class="p">{</span>
                <span class="k">override</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="err">?</span><span class="p">&gt;</span> <span class="nf">create</span><span class="p">(</span><span class="n">modelClass</span><span class="p">:</span> <span class="nc">Class</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;):</span> <span class="nc">T</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nc">MainViewModel</span><span class="p">()</span> <span class="k">as</span> <span class="nc">T</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">).</span><span class="k">get</span><span class="p">(</span><span class="nc">MainViewModel</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>
    <span class="p">}</span>

		<span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ë§¤ë²ˆ <code class="language-plaintext highlighter-rouge">ViewModelProvider.Factory</code> ë¥¼ êµ¬í˜„ í•˜ë ¤ë©´ ë§ì€ ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ ì½”ë“œê°€ ìƒê¸¸ ìˆ˜ë°–ì— ì—†ëŠ”ë°, ê¸°ì¡´ì—ëŠ” ìœ„ì™€ ê°™ì´ ì§ì ‘ íŒ©í† ë¦¬ë¥¼ ìƒì„±í•´ì£¼ì–´ì•¼ í–ˆì§€ë§Œ <code class="language-plaintext highlighter-rouge">Dagger2</code>, <code class="language-plaintext highlighter-rouge">Koin</code> ë“±ì˜ ì˜ì¡´ì„± ì£¼ì… ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ ë¹„êµì  í¸ë¦¬í•˜ê²Œ ì´ìš©í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>

<p>í•˜ì§€ë§Œ <code class="language-plaintext highlighter-rouge">Dagger2</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„ ë³µì¡í•œ ì–´ë…¸í…Œì´ì…˜, ë†’ì€ ëŸ¬ë‹ì»¤ë¸Œ ë•Œë¬¸ì— ë¶ˆí¸í•¨ì´ ë§ì•˜ëŠ”ë° ìµœê·¼ <code class="language-plaintext highlighter-rouge">Dagger Hilt</code> ê°€ ìƒˆë¡œ ë‚˜ì˜¤ë©´ì„œ ì ì€ ì½”ë“œë§Œìœ¼ë¡œë„ ë·°ëª¨ë¸ ì£¼ì…ì´ ê°€ëŠ¥í•´ì¡ŒìŠµë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">Dagger Hilt</code> ì— ëŒ€í•´ í•™ìŠµí•´ë³´ë©´ì„œ ì–´ë–»ê²Œ ì•„ë˜ì˜ ì½”ë“œê°€ ë™ì‘í•˜ëŠ” ê²ƒì¸ì§€ ê¶ê¸ˆì¦ì´ ìƒê²¨ì„œ ë™ì‘ ì›ë¦¬ë¥¼ ì•Œì•„ë³´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@HiltAndroidApp</span>
<span class="kd">class</span> <span class="nc">MyApplication</span> <span class="p">:</span> <span class="nc">Application</span><span class="p">()</span>

<span class="nd">@AndroidEntryPoint</span>
<span class="kd">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">viewModel</span> <span class="p">:</span> <span class="nc">MainViewModel</span> <span class="k">by</span> <span class="nf">viewModels</span><span class="p">()</span>
<span class="p">}</span>

<span class="nd">@HiltViewModel</span>
<span class="kd">class</span> <span class="nc">MainViewModel</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">()</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span>
</code></pre></div></div>

<p>ê²°ë¡ ë¶€í„° ë§í•˜ìë©´, Dagger hilt ë„ Dagger2 ì—ì„œì˜ ë°©ì‹ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë©€í‹°ë°”ì¸ë”© ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ ë·°ëª¨ë¸ì„ ìƒì„±í•˜ê³  ì£¼ì…í•´ì¤ë‹ˆë‹¤. ë”°ë¼ì„œ ëŒ€ê±°ì˜ ë©€í‹°ë°”ì¸ë”© ê¸°ëŠ¥, ê¸°ì¡´ Dagger2 ì—ì„œ ë·°ëª¨ë¸ ìƒì„± ë°©ì‹, ë§ˆì§€ë§‰ìœ¼ë¡œ Hilt ì—ì„œ ë·°ëª¨ë¸ ìƒì„± ë°©ì‹ì„ ì°¨ë¡€ëŒ€ë¡œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</p>

<h2 id="ë©€í‹°ë°”ì¸ë”©">ë©€í‹°ë°”ì¸ë”©</h2>

<p>ìš°ì„  ë¨¼ì € ì•Œì•„ì•¼ í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤. ê¸°ì¡´ Dagger2 ë¥¼ ì‚¬ìš©í•  ë•Œ, Dagger2 ì—ì„œ ì§€ì›í•˜ëŠ” ê¸°ëŠ¥ì¸ ë©€í‹°ë°”ì¸ë”©ì„ í™œìš©í•˜ì—¬ <code class="language-plaintext highlighter-rouge">ViewModelProvider.Factory</code> ë¥¼ ë§¤ë²ˆ êµ¬í˜„í•˜ì§€ ì•Šê³ ë„ ì‚¬ìš©í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë©€í‹°ë°”ì¸ë”©ì€ ëŒ€ê±° ëª¨ë“ˆ ì•ˆì— <code class="language-plaintext highlighter-rouge">@IntoMap</code> ì–´ë…¸í…Œì´ì…˜ì´ ì§€ì •ëœ ëª¨ë“  ì£¼ì… ëŒ€ìƒ ê°ì²´ë¥¼ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì— ì„ ì–¸ëœ Map ì¸ìŠ¤í„´ìŠ¤ì— ëª¨ì•„ì£¼ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Module</span>
<span class="kd">class</span> <span class="nc">SamsungModule</span> <span class="p">{</span>
    <span class="nd">@Provides</span>
    <span class="nd">@IntoMap</span>
    <span class="nd">@StringKey</span><span class="p">(</span><span class="s">"daeyeon"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">provideGalaxyS21</span><span class="p">()</span> <span class="p">=</span> <span class="s">"galaxy s21"</span>

    <span class="nd">@Provides</span>
    <span class="nd">@IntoMap</span>
    <span class="nd">@StringKey</span><span class="p">(</span><span class="s">"sungkyu"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">provideGalaxyNote20</span><span class="p">()</span> <span class="p">=</span> <span class="s">"galaxy note 20"</span>
<span class="p">}</span>

<span class="nd">@Module</span>
<span class="kd">class</span> <span class="nc">GoogleModule</span> <span class="p">{</span>
    <span class="nd">@Provides</span>
    <span class="nd">@IntoMap</span>
    <span class="nd">@StringKey</span><span class="p">(</span><span class="s">"boye"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">providePixel5</span><span class="p">()</span> <span class="p">=</span> <span class="s">"google pixel 5"</span>

    <span class="nd">@Provides</span>
    <span class="nd">@IntoMap</span>
    <span class="nd">@StringKey</span><span class="p">(</span><span class="s">"sohee"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">providePixel3L</span><span class="p">()</span> <span class="p">=</span> <span class="s">"google pixel 3L"</span>
<span class="p">}</span>

<span class="nd">@Component</span><span class="p">(</span><span class="n">modules</span> <span class="p">=</span> <span class="p">[</span><span class="nc">SamsungModule</span><span class="o">::</span><span class="k">class</span><span class="p">,</span> <span class="nc">GoogleModule</span><span class="o">::</span><span class="k">class</span><span class="p">])</span>
<span class="kd">interface</span> <span class="nc">AndroidComponent</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">phones</span><span class="p">():</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">String</span><span class="p">&gt;</span>

    <span class="nd">@Component</span><span class="p">.</span><span class="nc">Factory</span>
    <span class="kd">interface</span> <span class="nc">Factory</span> <span class="p">{</span>
        <span class="k">fun</span> <span class="nf">build</span><span class="p">():</span> <span class="nc">AndroidComponent</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ì»´í¬ë„ŒíŠ¸ì—ì„œ phones() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì„œ ë¡œê·¸ë¥¼ ì¶œë ¥í•´ë³´ë©´ ëª¨ë“ˆì— ì„ ì–¸í•´ë†“ì€ StringKey ë° ë¬¸ìì—´ê³¼ ë™ì¼í•˜ê²Œ í‘œì‹œë©ë‹ˆë‹¤.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">component</span> <span class="p">=</span> <span class="nc">DaggerAndroidComponent</span><span class="p">.</span><span class="nf">create</span><span class="p">()</span>
<span class="kd">val</span> <span class="py">phones</span> <span class="p">=</span> <span class="n">component</span><span class="p">.</span><span class="nf">phones</span><span class="p">()</span>
<span class="nf">println</span><span class="p">(</span><span class="s">"$phones"</span><span class="p">)</span>

<span class="c1">// {daeyeon=galaxy s21, sungkyu=galaxy note 20, boye=google pixel 5, sohee=google pixel 3L}</span>
</code></pre></div></div>

<p>ëŒ€ê±° ì»´í¬ë„ŒíŠ¸ì— ìƒì„±ëœ ì½”ë“œë¥¼ ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ê°ê°ì˜ ëª¨ë“ˆì— ì„ ì–¸ í•´ë†“ì€ ìŠ¤ë§ˆíŠ¸í° ê°ì²´ê°€ Map ì•ˆì— ë„£ì–´ì§€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="k">public</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">String</span><span class="p">&gt;</span> <span class="nf">phones</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nc">MapBuilder</span><span class="p">.&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">String</span><span class="p">&gt;</span><span class="nf">newMapBuilder</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"daeyeon"</span><span class="p">,</span> <span class="nc">SamsungModule_ProvideGalaxyS21Factory</span><span class="p">.</span><span class="nf">provideGalaxyS21</span><span class="p">(</span><span class="n">samsungModule</span><span class="p">))</span>
    <span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"sungkyu"</span><span class="p">,</span> <span class="nc">SamsungModule_ProvideGalaxyNote20Factory</span><span class="p">.</span><span class="nf">provideGalaxyNote20</span><span class="p">(</span><span class="n">samsungModule</span><span class="p">))</span>
    <span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"boye"</span><span class="p">,</span> <span class="nc">GoogleModule_ProvidePixel5Factory</span><span class="p">.</span><span class="nf">providePixel5</span><span class="p">(</span><span class="n">googleModule</span><span class="p">))</span>
    <span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"sohee"</span><span class="p">,</span> <span class="nc">GoogleModule_ProvidePixel3LFactory</span><span class="p">.</span><span class="nf">providePixel3L</span><span class="p">(</span><span class="n">googleModule</span><span class="p">))</span>
    <span class="p">.</span><span class="nf">build</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="ê¸°ì¡´-dagger2-ì—ì„œ-ë·°ëª¨ë¸-ìƒì„±-ë°©ì‹">ê¸°ì¡´ Dagger2 ì—ì„œ ë·°ëª¨ë¸ ìƒì„± ë°©ì‹</h2>

<p>ë¨¼ì € Dagger2 ì—ì„œì˜ ë·°ëª¨ë¸ ìƒì„± ë°©ì‹ì„ ë³´ê² ìŠµë‹ˆë‹¤. Dagger2 ì—ì„œ ë©€í‹°ë°”ì¸ë”© ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ë·°ëª¨ë¸ì„ ì‹ë³„í•´ì¤„ Key ì™€ ViewModel ê°ì²´ë¥¼ ëª¨ë“ˆì— ì„ ì–¸í•©ë‹ˆë‹¤.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Module</span>
<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">MainModule</span> <span class="p">{</span>
    <span class="nd">@Binds</span>
    <span class="nd">@IntoMap</span>
    <span class="nd">@ViewModelKey</span><span class="p">(</span><span class="nc">MainViewModel</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">bindHomeViewModel</span><span class="p">(</span><span class="n">mainViewModel</span><span class="p">:</span> <span class="nc">MainViewModel</span><span class="p">):</span> <span class="nc">ViewModel</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">ViewModelProvder.Factory</code> ë¥¼ ìƒì†ë°›ì€ ë·°ëª¨ë¸íŒ©í† ë¦¬(ViewModelFactory) í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ëŒ€ê±°ë¥¼ í†µí•´ ì£¼ì…ë°›ì€ map(<code class="language-plaintext highlighter-rouge">creators</code>)ì—ì„œ ë·°ëª¨ë¸ key ë¡œ ì¡°íšŒí•˜ì—¬ ë·°ëª¨ë¸ì„ ìƒì„±í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">ViewModelFactory</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">creators</span><span class="p">:</span> <span class="nd">@JvmSuppressWildcards</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">Class</span><span class="p">&lt;</span><span class="k">out</span> <span class="nc">ViewModel</span><span class="p">&gt;,</span> <span class="nc">Provider</span><span class="p">&lt;</span><span class="nc">ViewModel</span><span class="p">&gt;&gt;</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModelProvider</span><span class="p">.</span><span class="nc">Factory</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="err">?</span><span class="p">&gt;</span> <span class="nf">create</span><span class="p">(</span><span class="n">modelClass</span><span class="p">:</span> <span class="nc">Class</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;):</span> <span class="nc">T</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">found</span> <span class="p">=</span> <span class="n">creators</span><span class="p">.</span><span class="n">entries</span><span class="p">.</span><span class="nf">find</span> <span class="p">{</span> 
          <span class="n">modelClass</span><span class="p">.</span><span class="nf">isAssignableFrom</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">key</span><span class="p">)</span> 
        <span class="p">}</span>
        <span class="kd">val</span> <span class="py">creator</span> <span class="p">=</span> <span class="n">found</span><span class="o">?.</span><span class="n">value</span> 
          <span class="o">?:</span> <span class="k">throw</span> <span class="nc">IllegalArgumentException</span><span class="p">(</span><span class="s">"unknown model class $modelClass"</span><span class="p">)</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nd">@Suppress</span><span class="p">(</span><span class="s">"UNCHECKED_CAST"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">creator</span><span class="p">.</span><span class="k">get</span><span class="p">()</span> <span class="k">as</span> <span class="nc">T</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nc">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Module</span>
<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">ViewModelFactoryModule</span> <span class="p">{</span>
  <span class="nd">@Binds</span>
  <span class="nd">@Singleton</span>
  <span class="k">fun</span> <span class="nf">bindViewModelFactory</span><span class="p">(</span>
    <span class="n">viewModelFactory</span><span class="p">:</span> <span class="nc">ViewModelFactory</span>
  <span class="p">):</span> <span class="nc">ViewModelProvider</span><span class="p">.</span><span class="nc">Factory</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ì•¡í‹°ë¹„í‹°ì—ì„œëŠ” viewModelFactory ë¥¼ ì£¼ì… ë°›ì•„ì„œ ë·°ëª¨ë¸ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>

 <span class="nd">@Inject</span>
 <span class="kd">val</span> <span class="py">viewModelFactory</span><span class="p">:</span> <span class="nc">ViewModelProvider</span><span class="p">.</span><span class="nc">Factory</span>

 <span class="k">private</span> <span class="kd">val</span> <span class="py">viewModel</span><span class="p">:</span> <span class="nc">MainViewModel</span> <span class="k">by</span> <span class="nf">viewModels</span><span class="p">({</span> <span class="n">viewModelFactory</span> <span class="p">})</span>
 <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Dagger2 ë¥¼ ì‚¬ìš© í–ˆì„ ë•ŒëŠ” ë·°ëª¨ë¸ í´ë˜ìŠ¤ê°€ ì¶”ê°€ë  ë•Œë§ˆë‹¤ ë§¤ë²ˆ viewModelFactory ë¥¼ ë§Œë“¤ì–´ì£¼ì–´ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì€ ê°œì„  ë˜ì—ˆì§€ë§Œ, ë©€í‹°ë°”ì¸ë”© ê¸°ëŠ¥ì— ëŒ€í•œ í•™ìŠµì´ í•„ìš”í•˜ê³  ì˜ì¡´ì„± ì£¼ì…ì„ í•˜ê¸° ìœ„í•´ í•„ìˆ˜ì ìœ¼ë¡œ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ëª¨ë“ˆì´ ë§ì•˜ìŠµë‹ˆë‹¤.</p>

<h2 id="dagger-hilt-ì—ì„œ-ë·°ëª¨ë¸-ìƒì„±-ë°©ì‹">Dagger Hilt ì—ì„œ ë·°ëª¨ë¸ ìƒì„± ë°©ì‹</h2>

<p>Dagger Hilt ë„ Dagger2 ì‚¬ìš©í•  ë•Œì™€ ë™ì¼í•˜ê²Œ ë©€í‹°ë°”ì¸ë”©ì„ í†µí•´ ë·°ëª¨ë¸ì„ ì£¼ì… ë°›ìŠµë‹ˆë‹¤. ìš°ì„  ë·°ëª¨ë¸ì— ì„ ì–¸í•œ <code class="language-plaintext highlighter-rouge">@HiltViewModel</code> ì–´ë…¸í…Œì´ì…˜ì„ ì½ì–´ì„œ ViewModel ì£¼ì…ì„ ìœ„í•œ ëª¨ë“ˆì„ ìƒì„±í•´ì¤ë‹ˆë‹¤. ìƒì„±ëœ ë©”ì„œë“œëŠ” <code class="language-plaintext highlighter-rouge">XXXViewModel_HiltModules.java</code> íŒŒì¼ì— ì¶”ê°€ë˜ê³ ,  <code class="language-plaintext highlighter-rouge">DaggerApp_HiltComponents_SingletonC.java</code> íŒŒì¼ ë‚´ë¶€ë¥¼ ë³´ë©´ <code class="language-plaintext highlighter-rouge">getHiltViewModelMap()</code> ë©”ì„œë“œì— ë·°ëª¨ë¸ì´ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MainViewModel_HiltModules.java</span>
<span class="nd">@Module</span>
<span class="nd">@InstallIn</span><span class="o">(</span><span class="nc">ViewModelComponent</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">BindsModule</span> <span class="o">{</span>
  <span class="nd">@Binds</span>
  <span class="nd">@IntoMap</span>
  <span class="nd">@StringKey</span><span class="o">(</span><span class="s">"com.android.hiltsample.MainViewModel"</span><span class="o">)</span>
  <span class="nd">@HiltViewModelMap</span>
  <span class="kd">public</span> <span class="kd">abstract</span> <span class="nc">ViewModel</span> <span class="nf">binds</span><span class="o">(</span><span class="nc">MainViewModel</span> <span class="n">vm</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// DaggerApp_HiltComponents_SingletonC</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Provider</span><span class="o">&lt;</span><span class="nc">ViewModel</span><span class="o">&gt;&gt;</span> <span class="nf">getHiltViewModelMap</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="nc">Collections</span><span class="o">.&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Provider</span><span class="o">&lt;</span><span class="nc">ViewModel</span><span class="o">&gt;&gt;</span><span class="n">singletonMap</span><span class="o">(</span>
    <span class="s">"com.android.hiltsample.MainViewModel"</span><span class="o">,</span> <span class="o">(</span><span class="nc">Provider</span><span class="o">)</span> <span class="n">mainViewModelProvider</span><span class="o">()</span>
	<span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ì•¡í‹°ë¹„í‹°ì—ì„œëŠ” <code class="language-plaintext highlighter-rouge">@AndroidEntryPoint</code> ì–´ë…¸í…Œì´ì…˜ì„ ì½ì–´ì„œ <code class="language-plaintext highlighter-rouge">Hilt_XXXActivity</code> ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>

<p>Hilt Gradle plugin ì´ ë°”ì´íŠ¸ì½”ë“œ ë³€í™˜ì„ ì‹¤í–‰í•´ì„œ ì‹¤ì œë¡œëŠ” ì•„ë˜ì™€ ê°™ì€ ìƒì† êµ¬ì¡°ë¥¼ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@AndroidEntryPoint</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Hilt_HomeActivity</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>

<span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Hilt_HomeActivity</span> <span class="kd">extends</span> <span class="nc">AppCompatActivity</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>
</code></pre></div></div>

<p>ì•ˆë“œë¡œì´ë“œ ìŠ¤íŠœë””ì˜¤ì—ì„œ [Build] - [Analyze APKâ€¦] ë¥¼ ì‹¤í–‰í•˜ê³  MainActivity ì˜ ë°”ì´íŠ¸ì½”ë“œë¥¼ ë³´ë©´ Hilt_MainActivity ë¥¼ ìƒì†í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<figure class="fullwidth">
  <img src="http://labs.brandi.co.kr///assets/2021/0427/1.png" alt="athena" />
</figure>
<figcaption></figcaption>

<p><code class="language-plaintext highlighter-rouge">Hilt_XXXActivity</code> ë‚´ë¶€ì—ì„œëŠ” <code class="language-plaintext highlighter-rouge">getDefaultViewModelProviderFactory()</code> ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬  ì•ì„œ Dagger2 ë¥¼ ì‚¬ìš©í•  ë•Œ ì§ì ‘ ë§Œë“¤ì—ˆë˜ <code class="language-plaintext highlighter-rouge">ViewModelFactory</code> ì™€ ë™ì¼í•œ ì—­í• ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ <code class="language-plaintext highlighter-rouge">HiltViewModelFactory</code> ë¥¼ ë°˜í™˜í•˜ë„ë¡ í•©ë‹ˆë‹¤.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">abstract</span> <span class="kd">class</span> <span class="nc">Hilt_MainActivity</span> <span class="n">extends</span> <span class="nc">AppCompatActivity</span> <span class="n">implements</span> <span class="nc">GeneratedComponentManagerHolder</span> <span class="p">{</span>

	<span class="c1">// ...</span>

  <span class="nd">@Override</span>
  <span class="k">public</span> <span class="nc">ViewModelProvider</span><span class="p">.</span><span class="nc">Factory</span> <span class="nf">getDefaultViewModelProviderFactory</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">DefaultViewModelFactories</span><span class="p">.</span><span class="nf">getActivityFactory</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>HiltViewModelFactory ë¥¼ ë³´ë©´ hiltViewModelMap ì—ì„œ ë·°ëª¨ë¸ì„ ê°€ì ¸ì™€ì„œ ìƒì„±í•´ì£¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">final</span> <span class="kd">class</span> <span class="nc">HiltViewModelFactory</span> <span class="n">implements</span> <span class="nc">ViewModelProvider</span><span class="p">.</span><span class="nc">Factory</span> <span class="p">{</span>	

  <span class="k">public</span> <span class="nc">HiltViewModelFactory</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">this</span><span class="p">.</span><span class="n">hiltViewModelFactory</span> <span class="p">=</span>
        <span class="n">new</span> <span class="nc">AbstractSavedStateViewModelFactory</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">defaultArgs</span><span class="p">)</span> <span class="p">{</span>
          <span class="nd">@NonNull</span>
          <span class="nd">@Override</span>
          <span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">"unchecked"</span><span class="p">)</span>
          <span class="k">protected</span> <span class="p">&lt;</span><span class="nc">T</span> <span class="n">extends</span> <span class="nc">ViewModel</span><span class="p">&gt;</span> <span class="nc">T</span> <span class="nf">create</span><span class="p">(</span>
              <span class="nd">@NonNull</span> <span class="nc">String</span> <span class="n">key</span><span class="p">,</span> <span class="nd">@NonNull</span> <span class="nc">Class</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;</span> <span class="n">modelClass</span><span class="p">,</span> <span class="nd">@NonNull</span> <span class="nc">SavedStateHandle</span> <span class="n">handle</span><span class="p">)</span> <span class="p">{</span>
           <span class="nc">ViewModelComponent</span> <span class="n">component</span> <span class="p">=</span>
               <span class="n">viewModelComponentBuilder</span><span class="p">.</span><span class="nf">savedStateHandle</span><span class="p">(</span><span class="n">handle</span><span class="p">).</span><span class="nf">build</span><span class="p">();</span>
           <span class="nc">Provider</span><span class="p">&lt;</span><span class="err">?</span> <span class="err">extends</span> <span class="nc">ViewModel</span><span class="p">&gt;</span> <span class="n">provider</span> <span class="p">=</span>
              <span class="nc">EntryPoints</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="nc">ViewModelFactoriesEntryPoint</span><span class="p">.</span><span class="k">class</span><span class="p">)</span>
                  <span class="p">.</span><span class="nf">getHiltViewModelMap</span><span class="p">()</span>
                  <span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="n">modelClass</span><span class="p">.</span><span class="nf">getName</span><span class="p">());</span>
           <span class="c1">// ...</span>
           <span class="k">return</span> <span class="p">(</span><span class="nc">T</span><span class="p">)</span> <span class="n">provider</span><span class="p">.</span><span class="k">get</span><span class="p">();</span>
         <span class="p">}</span>
      <span class="p">};</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>ì•¡í‹°ë¹„í‹°ì—ì„œëŠ” defaultViewModelProviderFactory ë¡œ <code class="language-plaintext highlighter-rouge">HiltViewModelFactory</code> ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ ë˜ì–´ì„œ activity-ktx ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì„ ì–¸ëœ í™•ì¥í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ê°„ë‹¨í•˜ê²Œ AAC-ViewModel ì„ ìƒì„±í•˜ê³  ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@AndroidEntryPoint</span>
<span class="kd">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">private</span> <span class="kd">val</span> <span class="py">viewModel</span> <span class="p">:</span> <span class="nc">MainViewModel</span> <span class="k">by</span> <span class="nf">viewModels</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>ì´ë²ˆì— ê¶ê¸ˆì¦ì„ í•´ê²°í•˜ê¸° ìœ„í•´ í•™ìŠµí•˜ë©´ì„œ ê¸°ì¡´ Dagger2 ì˜ ë¶ˆí¸í•¨ì„ ë§ì´ ê°œì„ í–ˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. AAC-ë·°ëª¨ë¸ì„ ìƒì„±í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ë§ì€ ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ ì½”ë“œì™€ í•™ìŠµì´ í•„ìš” í–ˆì—ˆëŠ”ë°, Dagger Hilt ì—ì„œ ê°œë°œìê°€ ì§ì ‘ êµ¬í˜„í–ˆì–´ì•¼ í–ˆë˜ ëª¨ë“ˆ, ì»´í¬ë„ŒíŠ¸ë¥¼ ëª¨ë‘ ë¯¸ë¦¬ ìƒì„±í•´ì£¼ì–´ì„œ ê°„ë‹¨í•˜ê²Œ DI ì„ í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ë†’ì€ ëŸ¬ë‹ì»¤ë¸Œê°€ ê°œì„ ë˜ê³  ì´ì „ì— ë¹„í•´ í¸ë¦¬í•´ì¡Œê¸° ë•Œë¬¸ì— ì •ì‹ ë²„ì „ì´ ë‚˜ì˜¤ë©´ ì¶©ë¶„íˆ ë„ì…í•  ê°€ì¹˜ê°€ ìˆë‹¤ê³  ìƒê°ë©ë‹ˆë‹¤. ì´ìƒìœ¼ë¡œ ê¸€ì„ ë§ˆì¹˜ê² ìŠµë‹ˆë‹¤!</p>

<h2 id="ì°¸ê³ -ì‚¬ì´íŠ¸">ì°¸ê³  ì‚¬ì´íŠ¸</h2>

<p><a href="https://medium.com/@jungil.han/%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-viewmodel-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-2e4d136d28d2">https://medium.com/@jungil.han/ì•„í‚¤í…ì²˜-ì»´í¬ë„ŒíŠ¸-viewmodel-ì´í•´í•˜ê¸°-2e4d136d28d2</a></p>

<p><a href="https://dagger.dev/dev-guide/">https://dagger.dev/dev-guide/</a></p>
:ET